import{T as E}from"./Title.c3de74d2.js";import{u as f,d as b,o as v,c as h,a as s,t as m,f as S,q as L,p as C,b as M,I as N,r as p,K as D,z as U,L as q,M as z,g,h as J,l as W,F as K,y as O,j as G,w as H,N as P,A as Q}from"./vendor.e42f0259.js";import{_ as w,s as F,f as y,h as X,a as Y}from"./index.0bf825a6.js";import{C as Z}from"./ChangeAvatar.75799211.js";function ee(a,t){function r(...o){a(()=>t.apply(this,o),{fn:t,thisArg:this,args:o})}return r}function te(a,t={}){let r,o;return c=>{const n=f(a),i=f(t.maxWait);if(r&&clearTimeout(r),n<=0||i!==void 0&&i<=0)return o&&(clearTimeout(o),o=null),c();i&&!o&&(o=setTimeout(()=>{r&&clearTimeout(r),o=null,c()},i)),r=setTimeout(()=>{o&&clearTimeout(o),o=null,c()},n)}}function ae(a,t=200,r={}){return ee(te(t,r),a)}const se=a=>(C("data-v-28084295"),a=a(),M(),a),oe={class:"fs-4"},re=se(()=>s("div",{class:"arrow-left"},null,-1)),ne=b({props:{message:{type:Object,required:!0},userID:{type:String,required:!0}},setup(a){const t=a;function r(o){switch(o.userID){case t.userID:return"local";case"join":return"join";default:return"server"}}return(o,x)=>(v(),h("div",{class:L(["chat-message",r(a.message)])},[s("span",oe,m(a.message.avatar),1),s("div",null,[re,S(" "+m(a.message.text),1)])],2))}});var ue=w(ne,[["__scopeId","data-v-28084295"]]);const T=a=>(C("data-v-625443e2"),a=a(),M(),a),le={class:"d-flex"},ie={class:"flex-fill"},ce={id:"chat"},de={class:"d-flex align-items-center mb-3 justify-content-between"},ve=T(()=>s("span",null,"\u{1F4CB}",-1)),me=[ve],_e={type:"button",id:"chat-avatar",class:"btn btn-primary fs-1 ms-3","data-bs-toggle":"modal","data-bs-target":"#avatar-modal"},pe={class:"card mb-3"},he={id:"messages",class:"card-block"},fe={key:0},ge={class:"d-flex mb-3"},xe={class:"text-nowrap"},Ie=["onClick","disabled"],be=T(()=>s("span",null,"\u2709\uFE0F",-1)),De=[be],Fe=b({setup(a){const t=N("socket"),r=["\u{1F604}","\u{1F643}","\u{1F60B}","\u{1F920}","\u{1F913}","\u{1F60E}","\u{1F9D0}","\u{1F608}","\u{1F479}","\u{1F921}","\u{1F47A}","\u{1F4A9}","\u{1F47E}","\u{1F916}","\u{1F47D}","\u{1F480}","\u{1F63C}","\u{1F435}","\u{1F436}","\u{1F984}","\u{1F417}","\u{1F989}"];var o=Math.floor(Math.random()*r.length);const x=F.getters.userInfo.avatar?F.getters.userInfo.avatar:r[o],c=p([]),n=p(""),i=p(n.value),A=ae((e,l)=>{t.emit("changeRoom",{join:e,leave:l,avatar:u.value.avatar}),_.value=[],i.value=e,c.value=[]},1e3);t.on("roomJoin",async e=>{_.value.push({avatar:e.username,text:`Joined room: ${i.value}`,userID:e.userID,roomID:n.value}),await D(),y("messages"),c.value.push({userID:e.userID,username:e.username})}),t.on("roomLeave",e=>{_.value.push({avatar:e.username,text:"Left the room",userID:e.userID,roomID:n.value}),c.value=c.value.filter(l=>l.userID!=e.userID)});const u=p({avatar:x,text:"",userID:t.id,roomID:n.value}),$=255,_=p([]);t.on("broadcastMessage",async e=>{_.value.push(e),await D(),y("messages")});function k(){R(u.value)&&(u.value.userID=t.id,u.value.roomID=n.value,t.emit("sendMessage",u.value),u.value.text="")}function R(e){return e.avatar.length>0&&e.text.length>0}U(()=>{window.onbeforeunload=function(){t.emit("changeRoom",{leave:n.value,avatar:u.value.avatar})},I=new bootstrap.Modal(document.getElementById("avatar-modal"))}),q(()=>{B()});function B(){t.emit("changeRoom",{leave:n.value,avatar:u.value.avatar})}z(n,(e,l)=>{e&&A(e,l)});let I=null;function V(e){const l=u.value.avatar;u.value.avatar=e,t.emit("sendMessage",{avatar:e,text:`${l} Change to ${e}`,userID:t.id,roomID:n.value}),I&&I.hide()}return(e,l)=>(v(),h("div",le,[s("div",ie,[s("div",ce,[s("div",de,[g(Y,{label:"",id:"room",type:"text",modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=d=>n.value=d),placeholder:"Room ID"},{button:J(()=>[s("button",{type:"button",class:"btn btn-primary copy",onClick:l[0]||(l[0]=d=>f(X)(n.value)),"aria-label":"Copy Room ID"},me)]),_:1},8,["modelValue"]),s("button",_e,m(u.value.avatar),1)]),s("div",pe,[s("div",he,[i.value?(v(),h("div",fe,[s("h3",null,"Room: "+m(i.value),1)])):W("",!0),(v(!0),h(K,null,O(_.value,(d,j)=>(v(),G(ue,{message:d,userID:f(t).id,key:j},null,8,["message","userID"]))),128))])]),s("div",ge,[H(s("textarea",{id:"textarea",class:"form-control me-3","onUpdate:modelValue":l[2]||(l[2]=d=>u.value.text=d),placeholder:"Enter message..."},null,512),[[P,u.value.text]]),s("div",xe,[s("button",{id:"send",class:"btn btn-primary fs-3 text-center",onClick:Q(k,["prevent"]),disabled:!u.value.text.length},De,8,Ie),s("div",null,m(u.value.text.length)+" / "+m($),1)])])])]),g(Z,{onUpdateAvatar:V})]))}});var ye=w(Fe,[["__scopeId","data-v-625443e2"]]);const Ce={id:"chat",class:"page"},$e=b({setup(a){return(t,r)=>(v(),h("div",Ce,[g(E,{title:"Chat"}),g(ye)]))}});export{$e as default};
