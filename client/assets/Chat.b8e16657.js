import{d as y,o as r,c as u,a as e,t as d,f as q,q as F,p as B,b as E,I as J,r as h,K as M,z,L as K,g as f,A as k,h as O,u as w,l as b,F as I,y as R,j as G,w as H,M as P}from"./vendor.d86d1c24.js";import{_ as S,s as $,i as A,j as Q,a as W}from"./index.4d96d4fc.js";import{C as X}from"./ChangeAvatar.872a8ce0.js";import{C as Y}from"./CommonTitle.207c5bbe.js";const Z=s=>(B("data-v-38ee55e4"),s=s(),E(),s),ee={class:"fs-4"},te=Z(()=>e("div",{class:"arrow-left"},null,-1)),ae=y({props:{message:{type:Object,required:!0},clientID:{type:String,required:!0}},setup(s){const o=s;function m(g){switch(g.clientID){case o.clientID:return"local";case"join":return"join";default:return"server"}}return(g,C)=>(r(),u("div",{class:F(["chat-message",m(s.message)])},[e("span",ee,d(s.message.avatar),1),e("div",null,[te,q(" "+d(s.message.text),1)])],2))}});var se=S(ae,[["__scopeId","data-v-38ee55e4"]]);const D=s=>(B("data-v-40fd49e3"),s=s(),E(),s),oe={class:"d-flex"},ne={class:"flex-fill"},le={id:"chat"},re={class:"d-flex align-items-center mb-3 justify-content-between"},ue=["onSubmit"],ie=D(()=>e("button",{type:"submit",class:"btn btn-primary no-border-radius","aria-label":"Join Room"},[e("span",null,"\u{1F680}")],-1)),ce=D(()=>e("span",null,"\u{1F4CB}",-1)),de=[ce],ve={type:"button",id:"chat-avatar",class:"btn btn-primary fs-1 ms-3","data-bs-toggle":"modal","data-bs-target":"#avatar-modal"},me={class:"card mb-3"},_e={id:"messages",class:"card-block"},pe={key:0},he={key:0,class:"d-flex mb-3"},ge={class:"text-nowrap text-center"},fe=["onClick","disabled"],xe=D(()=>e("span",null,"\u2709\uFE0F",-1)),be=[xe],Ie={key:0,class:"ms-4"},Fe={class:"participants card p-3"},ye={class:"fs-1"},De=y({setup(s){const o=J("socket"),m=["\u{1F604}","\u{1F643}","\u{1F60B}","\u{1F920}","\u{1F913}","\u{1F60E}","\u{1F9D0}","\u{1F608}","\u{1F479}","\u{1F921}","\u{1F47A}","\u{1F4A9}","\u{1F47E}","\u{1F916}","\u{1F47D}","\u{1F480}","\u{1F63C}","\u{1F435}","\u{1F436}","\u{1F984}","\u{1F417}","\u{1F989}"];var g=Math.floor(Math.random()*m.length);const C=$.getters.userInfo.avatar?$.getters.userInfo.avatar:m[g],v=h([]),n=h(""),i=h(n.value);function V(){i.value!==n.value&&(o.emit("changeRoom",{join:n.value,leave:i.value,avatar:a.value.avatar}),p.value=[],i.value=n.value,v.value=[])}function j(){o.emit("changeRoom",{leave:n.value,avatar:a.value.avatar})}o.on("roomJoin",async t=>{p.value.push({avatar:t.user.username,text:`Joined room: ${i.value}`,clientID:t.user.clientID,roomID:n.value}),v.value=t.roomUsers,await M(),A("messages")}),o.on("roomLeave",t=>{p.value.push({avatar:t.username,text:"Left the room",clientID:t.clientID,roomID:n.value}),v.value=v.value.filter(l=>l.clientID!=t.clientID)});const a=h({avatar:C,text:"",clientID:o.id,roomID:n.value}),_=255,p=h([]);o.on("broadcastMessage",async t=>{p.value.push(t),await M(),A("messages")});function T(){L(a.value)&&(a.value.clientID=o.id,a.value.roomID=n.value,o.emit("sendMessage",a.value),a.value.text="")}function L(t){return t.avatar.length>0&&t.text.length>0&&t.text.length<_}let x=null;function N(t){const l=a.value.avatar;a.value.avatar=t,o.emit("sendMessage",{avatar:t,text:`${l} Change to ${t}`,clientID:o.id,roomID:n.value}),x&&x.hide()}return z(()=>{x=new bootstrap.Modal(document.getElementById("avatar-modal"))}),K(()=>{j()}),(t,l)=>(r(),u(I,null,[f(Y,{title:"\u{1F5E8}\uFE0F Chat",subtitle:i.value?"Be Nice!":"Enter a Room ID to join a room!"},null,8,["subtitle"]),e("div",oe,[e("div",ne,[e("div",le,[e("div",re,[e("form",{onSubmit:k(V,["prevent"])},[f(W,{label:"",id:"room",type:"text",modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=c=>n.value=c),placeholder:"Room ID"},{button:O(()=>[ie,e("button",{type:"button",class:"btn btn-primary copy",onClick:l[0]||(l[0]=c=>w(Q)(n.value)),"aria-label":"Copy Room ID"},de)]),_:1},8,["modelValue"])],40,ue),e("button",ve,[e("span",null,d(a.value.avatar),1)])]),e("div",me,[e("div",_e,[i.value?(r(),u("div",pe,[e("h3",null,"Room: "+d(i.value),1)])):b("",!0),(r(!0),u(I,null,R(p.value,(c,U)=>(r(),G(se,{message:c,clientID:w(o).id,key:U},null,8,["message","clientID"]))),128))])]),i.value?(r(),u("div",he,[H(e("textarea",{id:"textarea",class:F(["form-control me-3",{"is-invalid":a.value.text.length>_}]),"onUpdate:modelValue":l[2]||(l[2]=c=>a.value.text=c),placeholder:"Enter message..."},null,2),[[P,a.value.text]]),e("div",ge,[e("button",{id:"send",class:"btn btn-primary fs-3 text-center",onClick:k(T,["prevent"]),disabled:!a.value.text.length||a.value.text.length>_},be,8,fe),e("div",{class:F({"text-danger":a.value.text.length>_})},d(a.value.text.length)+" / "+d(_),3)])])):b("",!0)])]),v.value.length?(r(),u("div",Ie,[e("div",Fe,[(r(!0),u(I,null,R(v.value,c=>(r(),u("div",ye,d(c.username),1))),256))])])):b("",!0),f(X,{onUpdateAvatar:N})])],64))}});var Ce=S(De,[["__scopeId","data-v-40fd49e3"]]);const Me={id:"chat",class:"page"},Ae=y({setup(s){return(o,m)=>(r(),u("div",Me,[f(Ce)]))}});export{Ae as default};
